from scapy.all import sniff, TCP, UDP, ICMP
import matplotlib.pyplot as plt

# Dictionary to store protocol counts
protocol_count = {
    "TCP": 0,
    "UDP": 0,
    "ICMP": 0
}

def analyze_packet(packet):
    if packet.haslayer(TCP):
        protocol_count["TCP"] += 1
    elif packet.haslayer(UDP):
        protocol_count["UDP"] += 1
    elif packet.haslayer(ICMP):
        protocol_count["ICMP"] += 1

print("Starting packet capture...")

# Capture exactly 100 packets
sniff(count=100, prn=analyze_packet)

print("Capture complete!")
print(protocol_count)

# Plot protocol distribution
protocols = protocol_count.keys()
counts = protocol_count.values()

plt.bar(protocols, counts)
plt.xlabel("Protocol")
plt.ylabel("Number of Packets")
plt.title("Protocol Distribution from Packet Capture")
plt.show()
